{"html":{"ja":"<span class=\"lang-ja\">\n<p>配点 : <var>1000</var> 点</p>\n\n<div class=\"part\">\n<section>\n<h3>問題文</h3><p>テレビドラマシリーズ『ストレンジャー・シングス』に触発されたクマのリマクは、現実世界と鏡像世界を歩いて行き来することにしました。</p>\n<p>二つの高さ <var>H</var> の完全二分木があり、それぞれの頂点は <var>1</var> から <var>2^H-1</var> までの標準的な番号付けがなされています。\nすなわち、根の番号は <var>1</var> で、番号 <var>x</var> の子の番号は <var>2 \\cdot x</var> と <var>2 \\cdot x + 1</var> です。</p>\n<p>一つの木が持つ葉の数を <var>L</var> とします。すなわち、<var>L = 2^{H-1}</var> です。</p>\n<p>数列 <var>1, \\ldots, L</var> の順列 <var>P_1, P_2, \\ldots, P_L</var> が与えられます。これは、二つの木を結ぶ <var>L</var> 本の <em>特殊辺</em> を表します。\nすなわち、第一の木の番号 <var>L+i-1</var> の頂点と第二の木の番号 <var>L+P_i-1</var> の頂点が一本の特殊辺で結ばれています。</p>\n<p align=\"center\"><img alt=\"入力例 1 のグラフ\" src=\"https://img.atcoder.jp/agc047/nice_wide_example.png\"></p>\n\n<p align=\"center\"><em>入力例 1 の図示。<var>P = (2, 3, 1, 4)</var> であり、緑の辺が特殊辺</em></p>\n\n<p>サイクルの <em>積</em> を、それに含まれる頂点の番号の積と定義します。<strong>ちょうど二本の特殊辺を持つような</strong> すべての単純サイクルの積の和を <var>(10^9+7)</var> で割った余りを求めてください。</p>\n<p>なお、単純サイクルとは、長さが <var>3</var> 以上であって頂点や辺の重複がないようなサイクルです。</p>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>制約</h3><ul>\n<li><var>2 \\leq H \\leq 18</var></li>\n<li><var>1 \\leq P_i \\leq L</var> (ただし <var>L = 2^{H-1}</var>)</li>\n<li><var>P_i \\neq P_j</var> (すなわち、この数列は <var>1, \\ldots, L</var> の順列である)</li>\n</ul>\n</section>\n</div>\n\n<hr>\n\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>入力</h3><p>入力は以下の形式で標準入力から与えられる (ここで、<var>L = 2^{H-1}</var> である)。</p>\n<pre><var>H</var>\n<var>P_1</var> <var>P_2</var> <var>\\cdots</var> <var>P_L</var>\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力</h3><p>ちょうど二本の特殊辺を持つようなすべての単純サイクルの積の和を求め、それを <var>(10^9+7)</var> で割った余りを出力せよ。</p>\n</section>\n</div>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>入力例 1</h3><pre>3\n2 3 1 4\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 1</h3><pre>121788\n</pre>\n\n<p>下図に考慮すべきサイクルを二つ示します (他にも存在します)。一つめのサイクルの積は <var>2 \\cdot 5 \\cdot 6 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 5 \\cdot 4 = 7200</var>、二つめのサイクルの積は <var>1 \\cdot 3 \\cdot 7 \\cdot 7 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 5 \\cdot 4 \\cdot 2 = 35280</var> です。三つめのサイクルは、特殊辺の数が二本でないため、考慮すべきサイクルではありません。</p>\n<p align=\"center\"><img alt=\"three cycles\" src=\"https://img.atcoder.jp/agc047/3_trees_font.png\"></p>\n\n</section>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>入力例 2</h3><pre>2\n1 2\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 2</h3><pre>36\n</pre>\n\n<p>グラフ中の唯一のサイクルは確かに特殊辺を二本持ち、その頂点番号の積は <var>1 \\cdot 3 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 2 = 36</var> です。</p>\n</section>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>入力例 3</h3><pre>5\n6 14 15 7 12 16 5 4 11 9 3 10 8 2 13 1\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 3</h3><pre>10199246\n</pre></section>\n</div>\n</span>","en":"<span class=\"lang-en\">\n<p>Score : <var>1000</var> points</p>\n\n<div class=\"part\">\n<section>\n<h3>Problem Statement</h3><p>Inspired by the tv series <em>Stranger Things</em>, bear Limak is going for a walk between two mirror worlds.</p>\n<p>There are two perfect binary trees of height <var>H</var>,\n    each with the standard numeration of vertices from <var>1</var> to <var>2^H-1</var>.\nThe root is <var>1</var> and the children of <var>x</var> are <var>2 \\cdot x</var> and <var>2 \\cdot x + 1</var>.</p>\n<p>Let <var>L</var> denote the number of leaves in a single tree, <var>L = 2^{H-1}</var>.</p>\n<p>You are given a permutation <var>P_1, P_2, \\ldots, P_L</var> of numbers <var>1</var> through <var>L</var>.\nIt describes <var>L</var> <em>special</em> edges that connect leaves of the two trees.\nThere is a special edge between vertex <var>L+i-1</var> in the first tree and vertex <var>L+P_i-1</var> in the second tree.</p>\n<p align=\"center\"><img alt=\"graph for sample1\" src=\"https://img.atcoder.jp/agc047/nice_wide_example.png\"></p>\n\n<p align=\"center\"><em>drawing for the first sample test, permutation <var>P = (2, 3, 1, 4)</var>, special edges in green</em></p>\n\n<p>Let's define <em>product</em> of a cycle as the product of numbers in its vertices.\nCompute the sum of products of all simple cycles that have <strong>exactly two special edges</strong>, modulo <var>(10^9+7)</var>.</p>\n<p>A simple cycle is a cycle of length at least 3, without repeated vertices or edges.</p>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Constraints</h3><ul>\n<li><var>2 \\leq H \\leq 18</var></li>\n<li><var>1 \\leq P_i \\leq L</var> where <var>L = 2^{H-1}</var></li>\n<li><var>P_i \\neq P_j</var> (so this is a permutation)</li>\n</ul>\n</section>\n</div>\n\n<hr>\n\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>Input</h3><p>Input is given from Standard Input in the following format (where <var>L = 2^{H-1}</var>).</p>\n<pre><var>H</var>\n<var>P_1</var> <var>P_2</var> <var>\\cdots</var> <var>P_L</var>\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Output</h3><p>Compute the sum of products of simple cycles that have exactly two special edges.\nPrint the answer modulo <var>(10^9+7)</var>.</p>\n</section>\n</div>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>Sample Input 1</h3><pre>3\n2 3 1 4\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 1</h3><pre>121788\n</pre>\n\n<p>The following drawings show two valid cycles (but there are more!) with products\n    <var>2 \\cdot 5 \\cdot 6 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 5 \\cdot 4 = 7200</var>\n    and <var>1 \\cdot 3 \\cdot 7 \\cdot 7 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 5 \\cdot 4 \\cdot 2 = 35280</var>.\nThe third cycle is invalid because it doesn't have exactly two special edges.</p>\n<p align=\"center\"><img alt=\"three cycles\" src=\"https://img.atcoder.jp/agc047/3_trees_font.png\"></p>\n\n</section>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>Sample Input 2</h3><pre>2\n1 2\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 2</h3><pre>36\n</pre>\n\n<p>The only simple cycle in the graph indeed has two special edges, and the product of vertices is\n    <var>1 \\cdot 3 \\cdot 3 \\cdot 1 \\cdot 2 \\cdot 2 = 36</var>.</p>\n</section>\n</div>\n\n<hr>\n\n<div class=\"part\">\n<section>\n<h3>Sample Input 3</h3><pre>5\n6 14 15 7 12 16 5 4 11 9 3 10 8 2 13 1\n</pre>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 3</h3><pre>10199246\n</pre></section>\n</div>\n</span>"},"endpoint":"https://atcoder.jp/contests/agc047/tasks/agc047_d"}