{"html":{"ja":"<span class=\"lang-ja\">\n<p>配点 : <var>600</var> 点</p>\n\n<div class=\"part\">\n<section>\n<h3>問題文</h3><p>長さ <var>2N</var> で <code>+</code> ,  <code>-</code>  が <var>N</var> 個ずつからなる文字列 <var>s</var> に対して次の問題を考え、その答えを  <var>p(s)</var> と書くことにします。</p>\n<blockquote>\n<p>数直線上の <var>x=1,2,3,\\ldots , 2N</var> の位置に <var>2N</var> 個のボールが並んでおり、そのうち <var>N</var> 個は <var>+1</var> の、残りの <var>N</var> 個は <var>-1</var> の電荷を持ちます。ボールの持つ電荷の並び方は <var>s</var> によって表され、<var>s</var> の <var>i</var> 文字目が <code>+</code> であれば <var>x=i</var> には <var>+1</var> の電荷を持つボールが、<code>-</code> であれば <var>x=i</var> には <var>-1</var> の電荷を持つボールが配置されていることを表します。</p>\n<p>それぞれのボールは、次の規則にしたがって、一斉に運動を始めます。ただし、数直線上でより小さい数が位置する方向を左、より大きい数が位置する方向を右と呼びます。</p>\n<ul>\n<li>各ボールに対して、各時点で <var>F</var> を次の式で定める<br>\n<var>F=\\lbrace</var> <var>(</var>自身より真に左に存在するボールの電荷の総和<var>)</var> <var>-</var> <var>(</var>自身より真に右に存在するボールの電荷の総和<var>)</var> <var>\\rbrace</var> <var>\\times</var> <var>(</var>自身の電荷<var>)</var></li>\n<li>各ボールは各時点で、<var>F</var> が正であれば右に、負であれば左に、毎秒 <var>1</var> の速さで動く</li>\n<li>同時に同じ座標に電荷 <var>+1</var> のボールと電荷 <var>-1</var> のボールが存在した場合、両者は打ち消しあって消滅する</li>\n</ul>\n<p>このとき、それぞれのボールが運動を始めてから消滅するまでに移動した距離（消滅した座標と初めの座標の差の絶対値）の総和はいくつでしょうか。</p>\n</blockquote>\n<p>長さ <var>2N</var> で、<code>+</code> ,  <code>-</code> ,  <code>?</code>  からなる文字列 <var>T</var> が与えられます。<var>T</var> の <code>?</code>  を  <code>+</code>  または  <code>-</code>  に置換することで得られる、 <code>+</code> ,  <code>-</code>  が <var>N</var> 個ずつからなる文字列 <var>s</var> 全てについての <var>p(s)</var> の総和を <var>998244353</var> で割った余りを求めてください。</p>\n<p>なお、与えられた制約と運動の規則の下で、有限の時間内に全てのボールが消滅すること、ボールが消滅しない限り各ボールの <var>F</var> の値が <var>0</var> にならないこと、<var>3</var> つ以上のボールが同時に同じ座標に位置する瞬間が無いこと、および <var>p(s)</var> が整数になることが示せます。</p>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>制約</h3><ul>\n<li><var>1\\leq N\\leq 3000</var></li>\n<li><var>N</var> は整数である</li>\n<li><var>|T|=2N</var></li>\n<li><var>T</var> の各文字は  <code>+</code> ,  <code>-</code> ,  <code>?</code>  のいずれかであり、 <code>+</code>  と  <code>-</code>  はそれぞれ <var>N</var> 個以下である</li>\n</ul>\n</section>\n</div>\n\n<hr>\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>入力</h3><p>入力は以下の形式で標準入力から与えられる。</p>\n<pre><var>N</var>\n<var>T</var>\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力</h3><p>答えを <var>998244353</var> で割った余りを整数で出力せよ。</p>\n</section>\n</div>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>入力例 1</h3><pre>2\n+??-\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 1</h3><pre>6\n</pre>\n<p><var>T</var> から得られる文字列 <var>s</var> として、 <code>++--</code>  と  <code>+-+-</code>  が考えられます。</p>\n<p><code>++--</code>  について、運動を開始した時点では各ボールの左右の電荷の総和、および <var>F</var> の値は次のようになります。</p>\n<p><img src=\"https://img.atcoder.jp/arc164/403850a82c3adfb838197734344ae193.png\"></p>\n<p>したがって、<var>x=1,2</var> のボールは右に、<var>x=3,4</var> のボールは左に動き始めます。\nこの場合、各ボールはその後運動の向きを変えることなく、 <var>0.5</var> 秒後に <var>x=2,3</var> にあったボールが <var>x=2.5</var> で、<var>1.5</var> 秒後に <var>x=1,4</var> にあったボールが <var>x=2.5</var> でそれぞれ消滅します。\nこの間に、<var>x=2,3</var> にあったボールは <var>0.5</var> ずつ、<var>x=1,4</var> にあったボールは <var>1.5</var> ずつの距離を移動しているため、<var>p(</var> <code>++--</code> <var>)=4</var> です。</p>\n<p>同様に観察すると <var>p(</var> <code>+-+-</code> <var>)=2</var> であることが分かるため、求める <var>p(s)</var> の総和は <var>6</var> となります。</p>\n</section>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>入力例 2</h3><pre>17\n??????????????????????????????????\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 2</h3><pre>285212526\n</pre>\n<p><var>p(s)</var> の総和を <var>998244353</var> で割った余りを出力してください。</p></section>\n</div>\n</span>","en":"<span class=\"lang-en\">\n<p>Score : <var>600</var> points</p>\n\n<div class=\"part\">\n<section>\n<h3>Problem Statement</h3><p>Consider the following problem for a string <var>s</var> of length <var>2N</var> formed by <var>N</var> <code>+</code> and <var>N</var> <code>-</code>, and let <var>p(s)</var> denote the answer.</p>\n<blockquote>\n<p>There are <var>2N</var> balls lined up at positions <var>x=1,2,3,\\ldots , 2N</var> on a number line, of which <var>N</var> have a charge of <var>+1</var> and the remaining <var>N</var> have a charge of <var>-1</var>. The arrangement of the charges of the balls is represented by <var>s</var>. If the <var>i</var>-th character of <var>s</var> is <code>+</code>, a ball with a charge of <var>+1</var> is placed at <var>x=i</var>; if it is <code>-</code>, a ball with a charge of <var>-1</var> is placed at <var>x=i</var>.</p>\n<p>Each ball starts motion simultaneously according to the following rules. Here, we call the direction where smaller numbers are located on the number line \"left\", and the direction where larger numbers are located \"right\".</p>\n<ul>\n<li>For each ball, define <var>F</var> at each moment by the following formula:<br>\n<var>F=\\lbrace</var> <var>(</var>the sum of the charges of the balls strictly to the left of itself<var>)</var> <var>-</var> <var>(</var>the sum of the charges of the balls strictly to the right of itself<var>)</var> <var>\\rbrace</var> <var>\\times</var> <var>(</var>the charge of itself<var>)</var>.</li>\n<li>At each moment, each ball moves to the right if <var>F</var> is positive, and to the left if <var>F</var> is negative, at a speed of <var>1</var> per second.</li>\n<li>If a ball with a charge of <var>+1</var> and a ball with a charge of <var>-1</var> exist at the same coordinate simultaneously, they cancel out each other and disappear.</li>\n</ul>\n<p>Then, what is the sum of the distances moved by the balls after they start motion and before they disappear (the distance moved by a ball is the absolute difference between the coordinates where it starts and where it disappears)?</p>\n</blockquote>\n<p>You are given a string <var>T</var> of length <var>2N</var> consisting of <code>+</code>, <code>-</code>, and <code>?</code>. Find the sum of <var>p(s)</var> over all strings <var>s</var> formed by <var>N</var> <code>+</code> and <var>N</var> <code>-</code> that can be obtained by replacing each <code>?</code> in <var>T</var> with <code>+</code> or <code>-</code>, modulo <var>998244353</var>.</p>\n<p>Under the given constraints and the rules of motion, it can be shown that all balls disappear in finite time, that the value of <var>F</var> for each ball does not become <var>0</var> until that ball disappears, that there is no moment when three or more balls are at the same coordinate simultaneously, and that <var>p(s)</var> is an integer.</p>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Constraints</h3><ul>\n<li><var>1\\leq N\\leq 3000</var></li>\n<li><var>N</var> is an integer.</li>\n<li><var>|T|=2N</var></li>\n<li>Each character of <var>T</var> is either <code>+</code>, <code>-</code>, or <code>?</code>, and there are at most <var>N</var> <code>+</code> and at most <var>N</var> <code>-</code>.</li>\n</ul>\n</section>\n</div>\n\n<hr>\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>Input</h3><p>The input is given from Standard Input in the following format:</p>\n<pre><var>N</var>\n<var>T</var>\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Output</h3><p>Print the answer modulo <var>998244353</var>, as an integer.</p>\n</section>\n</div>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>Sample Input 1</h3><pre>2\n+??-\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 1</h3><pre>6\n</pre>\n<p>The strings <var>s</var> that can be obtained from <var>T</var> are <code>++--</code> and <code>+-+-</code>.</p>\n<p>For <code>++--</code>, the sum of the charges of the balls to the left and right of each ball, and the value of <var>F</var> at the start of the motion are as follows:</p>\n<p><img src=\"https://img.atcoder.jp/arc164/2f5047a41704d1c88bb2df93f67ca583.png\"></p>\n<p>Thus, the balls at <var>x=1,2</var> start moving to the right, and the balls at <var>x=3,4</var> start moving to the left.\nThen, each ball continues to move in the same direction without changing its direction of motion, and the balls that started at <var>x=2,3</var> disappear at <var>x=2.5</var> after <var>0.5</var> seconds, and the balls that started at <var>x=1,4</var> disappear at <var>x=2.5</var> after <var>1.5</var> seconds.\nDuring these times, the balls that started at <var>x=2,3</var> move a distance of <var>0.5</var> each, and the balls that started at <var>x=1,4</var> move a distance of <var>1.5</var> each, so <var>p(</var> <code>++--</code> <var>)=4</var>.</p>\n<p>Similarly, it can be seen that <var>p(</var> <code>+-+-</code> <var>)=2</var>, so the sought sum of <var>p(s)</var> is <var>6</var>.</p>\n</section>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>Sample Input 2</h3><pre>17\n??????????????????????????????????\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 2</h3><pre>285212526\n</pre>\n<p>Be sure to print the sum of <var>p(s)</var> modulo <var>998244353</var>.</p></section>\n</div>\n</span>"},"endpoint":"https://atcoder.jp/contests/arc164/tasks/arc164_d"}