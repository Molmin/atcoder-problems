{"html":{"ja":"<span class=\"lang-ja\">\n<p>配点 : <var>650</var> 点</p>\n\n<div class=\"part\">\n<section>\n<h3>問題文</h3><p>頂点に <var>0</var> から <var>N</var> までの番号がついた <var>N + 1</var> 頂点の根付き木があります。頂点 <var>0</var> は根で、頂点 <var>i</var> の親は頂点 <var>p_i</var> です。<br>\n頂点 <var>1</var>, 頂点 <var>2</var>, <var>\\dots</var>, 頂点 <var>N</var> のうちどこか <var>1</var> 頂点に宝が隠されています。頂点 <var>i</var> に宝がある確率は <var>\\frac{a_i}{\\sum_{j=1}^N a_j}</var> です。\nまた、各頂点には「探索済」と「未探索」のどちらか一方の状態を持ちます。はじめ頂点 <var>0</var> は探索済で、それ以外の頂点は未探索です。<br>\nあなたは、宝がある頂点が探索済になるまで以下の操作を行います。</p>\n<ul>\n<li>親が探索済であるような未探索の頂点を選び、その頂点を探索済にする。</li>\n</ul>\n<p>操作回数の期待値が最小になるように行動した時の操作回数の期待値を <var>\\text{mod }998244353</var> で求めてください。</p>\n<p><var>T</var> 個のテストケースが与えられるので、それぞれに対して答えを求めてください。</p>\n<details>\n\n<summary>期待値 <var>\\text{mod }{998244353}</var> の定義</summary><p>\n\n求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 <var>\\frac{P}{Q}</var> で表した時、<var>Q \\not \\equiv 0 \\pmod{998244353}</var> となることも証明できます。このとき、<var>R \\times Q \\equiv P \\pmod{998244353}, 0 \\leq R \\lt 998244353</var> を満たす整数 <var>R</var> が一意に定まります。この <var>R</var> を答えてください。\n\n</p></details>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>制約</h3><ul>\n<li><var>1 \\leq T \\leq 2 \\times 10^5</var></li>\n<li><var>1 \\leq N \\leq 2 \\times 10^5</var></li>\n<li><var>0 \\leq p_i \\lt i</var></li>\n<li><var>1 \\leq a_i</var></li>\n<li><var>\\sum_{i=1}^N a_i \\leq 10^8</var></li>\n<li>全てのテストケースに対する <var>N</var> の総和は <var>2 \\times 10^5</var> 以下</li>\n<li>入力される値は全て整数</li>\n</ul>\n</section>\n</div>\n\n<hr>\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>入力</h3><p>入力は以下の形式で標準入力から与えられる。ここで <var>\\mathrm{case}_i</var> は <var>i</var> 番目のテストケースを意味する。</p>\n<pre><var>T</var>\n<var>\\mathrm{case}_1</var>\n<var>\\mathrm{case}_2</var>\n<var>\\vdots</var>\n<var>\\mathrm{case}_T</var>\n</pre>\n<p>各テストケースは以下の形式で与えられる。</p>\n<pre><var>N</var>\n<var>p_1</var> <var>p_2</var> <var>\\dots</var> <var>p_N</var>\n<var>a_1</var> <var>a_2</var> <var>\\dots</var> <var>a_N</var>\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力</h3><p><var>T</var> 行出力せよ。<var>i</var> 行目には <var>i</var> 番目のテストケースの答えを出力せよ。  </p>\n</section>\n</div>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>入力例 1</h3><pre>3\n3\n0 0 1\n1 2 3\n5\n0 1 0 0 0\n8 6 5 1 7\n10\n0 1 1 3 3 1 4 7 5 4\n43 39 79 48 92 90 76 30 16 30\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>出力例 1</h3><pre>166374061\n295776107\n680203339\n</pre>\n<p><var>1</var> 番目のテストケースにおける操作回数の期待値は <var>\\frac{13}{6}</var> です。</p></section>\n</div>\n</span>","en":"<span class=\"lang-en\">\n<p>Score : <var>650</var> points</p>\n\n<div class=\"part\">\n<section>\n<h3>Problem Statement</h3><p>There is a rooted tree with <var>N + 1</var> vertices numbered from <var>0</var> to <var>N</var>. Vertex <var>0</var> is the root, and the parent of vertex <var>i</var> is vertex <var>p_i</var>.<br>\nOne of the vertices among vertex <var>1</var>, vertex <var>2</var>, ..., vertex <var>N</var> hides a treasure. The probability that the treasure is at vertex <var>i</var> is <var>\\frac{a_i}{\\sum_{j=1}^N a_j}</var>.\nAlso, each vertex is in one of the two states: \"searched\" and \"unsearched\". Initially, vertex <var>0</var> is searched, and all other vertices are unsearched.<br>\nUntil the vertex containing the treasure becomes searched, you perform the following operation:</p>\n<ul>\n<li>Choose an unsearched vertex whose parent is searched, and mark it as searched.</li>\n</ul>\n<p>Find the expected number of operations required when you act to minimize the expected number of operations, modulo <var>998244353</var>.</p>\n<p>You are given <var>T</var> test cases; solve each of them.</p>\n<details>\n\n<summary>How to find an expected value modulo <var>998244353</var></summary><p>\n\nIt can be proved that the expected value is always a rational number. Under the constraints of this problem, it can also be proved that when the expected value is expressed as an irreducible fraction <var>\\frac{P}{Q}</var>, we have <var>Q \\not\\equiv 0 \\pmod{998244353}</var>. In this case, there is a unique integer <var>R</var> satisfying <var>R \\times Q \\equiv P \\pmod{998244353},\\ 0 \\leq R &lt; 998244353</var>. Report this <var>R</var>.\n\n</p></details>\n\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Constraints</h3><ul>\n<li><var>1 \\leq T \\leq 2 \\times 10^5</var></li>\n<li><var>1 \\leq N \\leq 2 \\times 10^5</var></li>\n<li><var>0 \\leq p_i &lt; i</var></li>\n<li><var>1 \\leq a_i</var></li>\n<li><var>\\sum_{i=1}^N a_i \\leq 10^8</var></li>\n<li>The sum of <var>N</var> over all test cases is at most <var>2 \\times 10^5</var>.</li>\n<li>All input values are integers.</li>\n</ul>\n</section>\n</div>\n\n<hr>\n<div class=\"io-style\">\n<div class=\"part\">\n<section>\n<h3>Input</h3><p>The input is given from Standard Input in the following format. Here, <var>\\mathrm{case}_i</var> denotes the <var>i</var>-th test case.</p>\n<pre><var>T</var>\n<var>\\mathrm{case}_1</var>\n<var>\\mathrm{case}_2</var>\n<var>\\vdots</var>\n<var>\\mathrm{case}_T</var>\n</pre>\n<p>Each test case is given in the following format:</p>\n<pre><var>N</var>\n<var>p_1</var> <var>p_2</var> <var>\\dots</var> <var>p_N</var>\n<var>a_1</var> <var>a_2</var> <var>\\dots</var> <var>a_N</var>\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Output</h3><p>Print <var>T</var> lines. The <var>i</var>-th line should contain the answer for the <var>i</var>-th test case.</p>\n</section>\n</div>\n</div>\n\n<hr>\n<div class=\"part\">\n<section>\n<h3>Sample Input 1</h3><pre>3\n3\n0 0 1\n1 2 3\n5\n0 1 0 0 0\n8 6 5 1 7\n10\n0 1 1 3 3 1 4 7 5 4\n43 39 79 48 92 90 76 30 16 30\n</pre>\n</section>\n</div>\n\n<div class=\"part\">\n<section>\n<h3>Sample Output 1</h3><pre>166374061\n295776107\n680203339\n</pre>\n<p>In the first test case, the expected number of operations is <var>\\frac{13}{6}</var>.</p></section>\n</div>\n</span>"},"endpoint":"https://atcoder.jp/contests/abc376/tasks/abc376_g"}